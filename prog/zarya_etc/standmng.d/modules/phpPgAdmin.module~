#!/bin/bash

what_todo=$1
param1=$2
###################################

#require httpd.module

install()
	{
	yum -y -q install php-pgsql phpPgAdmin
	}

set()
	{
	sed -i "s/\$conf\['servers'\]\[0\]\['host'\] = '';/\$conf\['servers'\]\[0\]\['host'\] = '127.0.0.1';/" /etc/phpPgAdmin/config.inc.php

	client_ip="`standmng get Client`"
	if [ "$client_ip" != "" ]
	then
		sed -i "s/# Allow from .example.com/Allow from $client_ip/" /etc/httpd/conf.d/phpPgAdmin.conf
	fi
	}

unset()
	{
	sed -i "/$param1/d" /etc/httpd/conf.d/phpPgAdmin.conf
	}

erase()
	{
	yum -y -q erase php-pgsql phpPgAdmin
	}

###################################
case $what_todo in
	install)
		echo "Installing $0..."
		install
		set
		;;
	set)
		echo "Setting $0..."
		set
		;;
	unset)
		echo "Unsetting $0..."
		if [ "$param1" = "" ]
		then
			echo "Error: Input parameter isn't set!"
			exit 1
		fi

		unset
		;;
	erase)
		echo "Erasing $0..."
		erase
		;;
	*)
		echo "Usage: $0 {install|set|unset <ip_addr>|erase}"
		exit 1
		;;
esac

